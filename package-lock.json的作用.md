# package-lock.json的作用

> package-lock.json就是一张完整的载货清单

package-lock.json是自动生成的，当执行npm install时，就是按照这张载货清单来安装package，它不需要手动修改。通常，npm执行一些操作修改了node_modules tree或者package.json时（比如npm install 新的package），package-lock.json就会同步更新。通俗地说，这个载货清单精确描述了node_modules tree，此后不论谁拿到这份package-lock.json，node_modules tree都将是相同的，这就是经常说的“锁定版本”。

package-lock.json会被提交到git仓库中，总结起来，有以下几个目的：

1. 描述依赖树，让团队其他成员在持续集成、部署时都能安装相同的依赖树；
2. package中的node_modules目录会被加进.gitignore，因此无法对它进行版本控制，package-lock.json提供了时间旅行的能力，用git reset回到过去某个依赖树版本，或者通过查看diff，解决一些现实问题；
3. 优化安装性能，让npm直接跳过解析过程，package-lock.json从v7开始就包含了足够的信息，足以描述一个完整的package tree，减少读取pacakge.json的需要，从而得到性能提升。

在package-lock.json中，有几个字段需要额外关注：

1. name，锁定所针对的package name；
2. version，锁定所针对的版本；
3. lockfileVersion，integer version，从1开始。表示生成package-lock.json时使用的是哪种语义，2表示npm v7；
4. packages，把package location映射成一个对象，这个对象描述了package的信息，root project的key是""空字符串，其它package的key是pacakge location相对于root project的相对路径，比如"node_modules/react"，以下是示例：

```json
{
  "node_modules/react": {
    "version": "18.2.0",
    "resolved": "https://registry.npmjs.org/react/-/react-18.2.0.tgz",
    "integrity": "sha512/3IjMdb2L9QbBdWiW5e3P2/npwMBaU9mHCSCUzNln0ZCYbcfTsGbTJrU/kGemdH2IWmB2ioZ+zkxtmq6g09fGQ==",
    "dependencies": {
      "loose-envify": "^1.1.0"
    },
    "engines": {
      "node": ">=0.10.0"
    }
  }
}
```

其它的字段可以查看[官方文档](https://docs.npmjs.com/cli/v7/configuring-npm/package-lock-json#file-format)。